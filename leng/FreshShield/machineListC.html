<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="format-detection" content="telephone=no">
		<title>北京中集智冷科技有限公司</title>
		<link rel="stylesheet" type="text/css" href="css/index.css" />
	</head>

	<body>
		<style>
			body {
				background-color: #F2F2F2!important;
			}
			
			.container {
				padding: 0 1.5rem;
				box-sizing: border-box;
			}
			
			.content {
				padding: 0 1.5rem;
				box-sizing: border-box;
			}
			
			.header {
				background: #37C0C4;
				height: 4.6rem;
				width: 100vw;
				line-height: 4.6rem;
				font-size: 1.6rem;
				position: fixed;
				top: 0px;
				left: 0px;
				z-index: 9999;
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0 1.5rem;
				box-sizing: border-box;
			}
			
			.header .addDevice {
				width: 1.6rem;
				height: 1.6rem;
				margin-right: 1.5rem;
			}
			
			.header .userCenter {
				width: 1.6rem;
				height: 1.6rem;
			}
			
			.searchdiv {
				margin-top: 5rem;
				margin-bottom: 0.4rem;
				height: 3rem;
				display: flex;
				background: #FFFFFF;
				border-radius: 5rem;
				justify-content: center;
				align-items: center;
			}
			
			.searchdiv img {
				width: 1.6rem;
				height: 1.6rem;
			}
			
			.searchdiv input {
				width: 16rem;
				height: 3rem;
				padding: 0;
				padding-left: 1.5rem;
			}
			
			#wrapper {
				width: 100%;
				position: absolute;
				left: 0;
				top: 8.4rem;
				overflow: hidden;
				z-index: 1;
				bottom: 0rem;
				padding: 0 1.5rem;
				box-sizing: border-box;
			}
			
			.list {
				margin-bottom: 1rem;
				padding: 0 1rem;
				box-sizing: border-box;
				height: 16rem;
				background: #FFFFFF;
				border-radius: 0.5rem;
			}
			
			.list:last-of-type {
				margin: 0;
			}
			
			.list .list_tittle {
				display: flex;
				align-items: center;
				height: 4rem;
				width: 100%;
				box-sizing: border-box;
				justify-content: space-between;
				border-bottom: 1px solid #ccc;
			}
			
			.list .list_tittle .tittlewen {
				font-size: 1.4rem;
				font-weight: bold;
			}
			
			.list .list_tittle .rightimg {
				width: 0.6rem;
				height: 1rem;
			}
			
			.list_tittle .device_img {
				width: 1rem;
				height: auto;
				margin-right: 1rem;
			}
			
			.list_tittle .ispay {
				color: #999999;
			}
			
			.list-content .nickname {
				color: #999999;
			}
			
			.list-content .paytimer {
				color: #999999;
			}
			
			.list-content .cssmoney {
				color: #FA7183;
			}
			
			.list_tittle p {
				display: flex;
				align-items: center;
			}
			
			.list-content div {
				float: none;
				display: flex;
				align-items: center;
				height: 2rem;
			}
			
			.list-content div p {
				width: 50%;
				text-align: left;
			}
			
			.scroll_box {
				padding: 0;
				box-sizing: border-box;
			}
			
			.btnpay {
				height: 2rem;
				width: 5rem;
				border-radius: 1rem;
				background: #FFFFFF;
				border: 1px solid #40C0C3;
				color: #40C0C3;
			}
		</style>
		<div class="container">
			<div class="header">
				<p><span>鲜盾</span></p>
				<p><img src="images/addDevice.png" class="addDevice" /> <img src="images/userCenter.png" class="userCenter" /></p>
			</div>
			<div class="searchdiv">
				<img src="img/search.png" class="searchimg" />
				<input type="text" id="search" placeholder="请输入查询的设备号" />
				<!--<input type="button" value="搜索" />-->
			</div>

			<div id="wrapper">
				<div class="scroller">
					<div class="scroll_box">

						<div class="list hidden">
							<div class="list_tittle">
								<p class="tittlewen">
									<span>设备号：</span>
									<span class="shebeihao">15651</span>
								</p>
								<p>
									<img src="img/right_shop_car.png" class="rightimg" />
								</p>

							</div>
							<div class="list-content">
								<div>
									<p>温度1：<span class="temp1">0.0</span>℃</p>
									<p>温度2：<span class="temp2">0.0</span>℃</p>

								</div>
								<div>
									<p>湿度2：<span class="humidity">-</span>%RH</p>
									<p>电量：<span class="power">-</span>%</p>
								</div>
								<div>
									<p>信号强度：<span class="signal">无</span></p>
									<p>箱体状态：<span class="boxstate">-</span></p>
								</div>
								<div>
									<p>报警温度区间：<span class="alarmArea"></span></p>
									<p>合格温度区间：<span class="AcceptableArea"></span></p>
								</div>

								<div>
									地理位置：<span class="address"></span>
								</div>

							</div>
						</div>

					</div>
					<div class="more">
						<i class="pull_icon"></i><span>上拉加载...</span>
					</div>
				</div>
			</div>

		</div>

		<script src="../js/iscroll.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=XP1alssWsEscC3NfYAhj6YfqKvgQgUXF" charset="utf-8"></script>
		<script type="text/javascript" src="../js/jquery-1.11.0.js"></script>
		<script>
			/*iscroll代码；
			 */
			var userinfo = JSON.parse(localStorage.getItem('isonline'));
			var _userName = userinfo.user;
			var _userPass = userinfo.pwd;
			var _openid = localStorage.getItem('openId');
			var myscroll_x = new iScroll("wrapper", {
				onScrollMove: function() {
					if(this.y < (this.maxScrollY)) {
						$('.pull_icon').addClass('flip');
						$('.pull_icon').removeClass('loading');
						$('.more span').text('释放加载...');
					} else {
						$('.pull_icon').removeClass('flip loading');
						$('.more span').text('上拉加载...')
					}
				},
				onScrollEnd: function() {
					if($('.pull_icon').hasClass('flip')) {
						$('.pull_icon').addClass('loading');
						$('.more span').text('加载中...');
						pullUpActions();
					}
				},
				onRefresh: function() {
					$('.more').removeClass('flip');
					$('.more span').text('上拉加载...');
				}
			});

			var _start = 0; //控制一次加载到页面条数的开头；
			function pullUpActions() {
				_start += 5;
				$(".wait").removeClass("hidden");
				machine_ajax_list(_start);
			}

			/*
			 * 获取地址的函数；
			 */
		
            machine_ajax_list(0)
			function machine_ajax_list(_start) {
				$.ajax({
					url: "http://www.zjcoldcloud.com/xiandun/public/index.php/index/device/device_list",
					type: "post",
					data: {
						openid: _openid,
						offset:_start

					},
					dataType: 'json',
					success: function(res) {
						console.log(res);
						if(res.code == 0 && res.message == 'success') {
							for(var i = 0; i < res.data.length; i++) {
								var _dem = $(".list").eq(0).clone().removeClass("hidden").appendTo(".scroll_box");
								_dem.find(".list-content .temp1").html(res.data[i].last_temperature01);
								_dem.find(".list-content .temp2").html(res.data[i].last_temperature02);
								_dem.find(".list-content .humidity").html(res.data[i].last_humidity);
								_dem.find(".list-content .speed").html(res.data[i].speed);
								_dem.find(".list-content .power").html(res.data[i].power == null ? "0" : res.data[i].power);
								_dem.find(".list_tittle .shebeihao").html(res.data[i].shebeibianhao);
								_dem.find(".list_tittle .worktime").html(res.data[i].time);
								_dem.find(".list-content .boxstate").html(res.data[i].xiangzistate=='close'?"关闭":"开启");
								_dem.find(".list-content .AcceptableArea").html(res.data[i].hegewenduqujian);
								_dem.find(".list-content .alarmArea").html(res.data[i].baojingwenduqujian);
								if(res.data[i].xinghaoqiangdu >= 0 && res.data[i].xinghaoqiangdu < 5) {
									_dem.find(".list-content  .signal").html("无信号");
								} else if(res.data[i].xinghaoqiangdu >= 5 && res.data[i].xinghaoqiangdu < 13) {
									_dem.find(".list-content  .signal").html("弱");
								} else if(res.data[i].xinghaoqiangdu >= 13 && res.data[i].xinghaoqiangdu < 20) {
									_dem.find(".list-content  .signal").html("良");
								} else if(res.data[i].xinghaoqiangdu >= 20 && res.data[i].xinghaoqiangdu < 26) {
									_dem.find(".list-content  .signal").html("好");
								} else if(res.data[i].xinghaoqiangdu >= 26) {
									_dem.find(".list-content  .signal").html("强");
								} else {
									_dem.find(".list-content  .signal").html("无信号");
								}
								my_machine_list(res.data[i].last_jingdu, res.data[i].last_weidu, _dem)
								/*$(".more_machine").before(_dem);*/
							}

						} else {
							$(".more").html("没有查询到更多记录");
						}
						myscroll_x.refresh();

					},
					error: function() {
						alert("网络错误，请重新进入页面");

						$(".wait").addClass("hidden");
						myscroll_x.refresh();
					}
				})
			}
			function my_machine_list(_jingDu, _weiDu, _dem) {
				//console.log(_jingDu+","+_weiDu)
				$.ajax({
					url: "http://api.map.baidu.com/geoconv/v1/?ak=XP1alssWsEscC3NfYAhj6YfqKvgQgUXF&from=1&to=5",
					type: "post",
					dataType: "JSONP",
					data: {
						coords: _jingDu + "," + _weiDu
					},
					success: function(data) {
						if(data.status == 0) {
							now_one_map_machine_list(data.result[0].x, data.result[0].y)
						} else {
							now_one_map_machine_list(0, 0)
						}
					},
					error: function() {
						$(".wait").addClass("hidden");
					}
				});
			

			function now_one_map_machine_list(_jingDu01, _weiDu01) {
				var point = new BMap.Point(_jingDu01, _weiDu01);
				var geoc = new BMap.Geocoder(); //添加地图到页面并确定中心点；
				geoc.getLocation(point, function(rs) {
					var addComp = rs.addressComponents;
					var address = (addComp.province == addComp.city) ? (addComp.city + addComp.district + addComp.street) : (addComp.province + addComp.city + addComp.district + addComp.street)
					if(address == "") {
						_dem.find(".list-content  .address").html("未发现位置信息")
					} else {
						_dem.find(".list-content  .address").html(address);
					}
				})
			}
			}
			$(".userCenter").on("click", function() {
				window.location.href = "html/user_sheZhi.html"
			})
			$("body").on("click",".scroll_box .list .list_tittle", function() {
				var num=$(this).find(".shebeihao").text();
				window.location.href = "html/details_lists.html?num_m="+num
			})
			$("body").on("click", ".btnpay", function() {
				alert("未开启。。。")
			})
		</script>
	</body>

</html>